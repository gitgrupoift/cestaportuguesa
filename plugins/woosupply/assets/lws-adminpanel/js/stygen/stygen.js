(function(a){a.widget("lws.lws_css_editor",{_create:function(){this.cssValues=lwsBase64.toObj(this.element.data("cssvalues"));this.defaultValues=lwsBase64.toObj(this.element.data("dftvalues"));this.menuTable={};this.cssObject={};this.miscValues={};this.cssChain="";this._createCssObject(this.cssValues);this._createMaster();this._addBackgroundSwitcher();this._setCssEditor();var b=this.element.find(".lwss_centraldiv");this.popupShadow=a("<div>").addClass("lwss-popup-shadow").appendTo(b);this.element.on("mouseover",".lwss_menu_selector",this._bind(this._overSelector,this));this.element.on("mouseover",".lwss_selector",this._bind(this._overSelector,this));this.element.on("mouseout",".lwss_menu_selector",this._bind(this._outSelector,this));this.element.on("mouseout",".lwss_selector",this._bind(this._outSelector,this));this.element.on("click",".lwss_menu_selector",this._bind(this._clickSelector,this));this.element.on("click",".lwss_selector",this._bind(this._clickSelector,this));this.element.on("click",".lwss-main-conteneur",this._bind(this._clickEditor,this));this.element.on("click",".lwss-sidemenu",this._bind(this._clickEditor,this));this.element.on("click",".lwss-btvisual",this._bind(this._switchToVisual,this));this.element.on("click",".lwss-btcss",this._bind(this._switchToCss,this));this.element.on("click",".lwss-reset",this._bind(this._resetCss,this));this.myStylingPanel=a("<div>").addClass("lwss_styling_panel").prependTo(b);this.myStylingPanel.lws_styling_panel({stygen:this});this._createCssResetList();this.makeCssChain()},_bind:function(b,c){return function(){return b.apply(c,arguments)}},_createMaster:function(){var b=this;this.masterObject={};var c=this.element.find(".lwss_sidemenu");this.element.find(".lwss-visual-conteneur").find(".lwss_selectable").each(function(){var e=a(this);var f="."+e.attr("class").split(" ").join(".");var h=b._createSelector(e,f);var g={Selectable:e,Selector:h,Class:f,Over:"no",Active:"no"};if(b.masterObject[f]==undefined){b.masterObject[f]={};b.masterObject[f].elements=[];b.masterObject[f].cssValues=(b.cssObject[f]!=undefined)?b.cssObject[f]:{idle:{}};if(b.cssObject[f]==undefined){b.cssObject[f]=b.masterObject[f].cssValues}var d=(f.search("lwss_modify")!=-1)?"<div class='lwss_menu_selector_icon lws-icon-quill'></div>":"";d+="<div class='lwss_menu_selector_text'>"+e.data("type")+"</div>";b.masterObject[f].menuItem=a("<div>").addClass("lwss_menu_selector").data("theClass",f).html(d).appendTo(c)}b.masterObject[f].elements.push(g)})},_createCssResetList:function(){var b=this;this.cssResetList={};this.myStylingPanel.find(".lwss_value").each(function(){b.cssResetList[a(this).data("css")]=""})},_setCssEditor:function(){this.cssConteneur=this.element.find(".lwss-css-conteneur");this.cssConteneur.find(".lwss-css-editor").append(a("<textarea>",{"class":"lwss-css-textarea",id:"lwss-cssta-"+this.uuid}))},_switchToVisual:function(b,c){var d=this.element.find(".lwss-btvisual");if(d.hasClass("lws-active")){return}else{this.myStylingPanel.lws_styling_panel("resetActiveValues");this.element.find(".lwss-btcss").removeClass("lws-active");d.addClass("lws-active");this.element.find(".lwss-visual-conteneur").css("display","flex");this.element.find(".lwss-css-conteneur").css("display","none");this.cssEditor.codemirror.off()}},_switchToCss:function(e,f){var c=this.element.find(".lwss-btcss");if(c.hasClass("lws-active")){return}else{this.element.find(".lwss-btvisual").removeClass("lws-active");c.addClass("lws-active");this.element.find(".lwss-css-conteneur").css("display","flex");this.element.find(".lwss-visual-conteneur").css("display","none");if(!this.cssEditor){this.cssEditor=wp.codeEditor.initialize(this.cssConteneur.find("#lwss-cssta-"+this.uuid),cm_settings)}this.makeCssChain();this.cssEditor.codemirror.setValue(this.cssChain);var d=this;var b;this.cssEditor.codemirror.on("keyup",function(){clearTimeout(b);b=setTimeout(d._bind(d._editorCssChanged,d),"1000")});this.cssEditor.codemirror.on("keydown",function(){clearTimeout(b)})}},_overSelector:function(b,c){var e=a(b.currentTarget).data("theClass");var d=this.masterObject[e];d.menuItem.addClass("lwss_over_msel");for(let i=0;i<d.elements.length;i++){d.elements[i].Selector.addClass("lwss_over_sel")}},_outSelector:function(b,c){var e=a(b.currentTarget).data("theClass");var d=this.masterObject[e];d.menuItem.removeClass("lwss_over_msel");for(let i=0;i<d.elements.length;i++){d.elements[i].Selector.removeClass("lwss_over_sel")}},_createSelector:function(b,e){if(b.prop("nodeName")=="INPUT"||(b.prop("nodeName")=="TEXTAREA")){if(b.attr("type")=="password"){b.prop("disabled",true)}var c=b.parent();var d=a("<div>",{"class":"lwss_wrapper"}).appendTo(c);b.detach().appendTo(d);theSelector=a("<div>",{"class":"lwss_selector lwss_inp_sel"}).data("theClass",e).appendTo(d)}else{theSelector=a("<div>",{"class":"lwss_selector"}).data("theClass",e).prependTo(b)}return a(theSelector)},_addBackgroundSwitcher:function(){var b=this.element.find(".lwss-main-conteneur");var e=a("<div>").addClass("lws-bg-switcher").appendTo(b);var d=a("<div>").addClass("lws-white-switcher").appendTo(e);d.click(function(){b.css("background","#ffffff")});var c=a("<div>").addClass("lws-black-switcher").appendTo(e);c.click(function(){b.css("background","#000000")})},placeSelectors:function(){this.element.find(".lwss_inp_sel").each(function(){var c=a(this);var b=c.parent().find(".lwss_selectable");c.outerWidth(b.outerWidth(true)+4).outerHeight(b.outerHeight(true)+4);c.css("top",b.position().top-2).css("left",b.position().left-2)})},_clickSelector:function(d){this.element.find(".lwss_selector").removeClass("lwss_sel_sel");this.element.find(".lwss_menu_selector").removeClass("lwss_sel_msel");var f=a(d.currentTarget).data("theClass");var e=this.masterObject[f];e.menuItem.addClass("lwss_sel_msel");for(let i=0;i<e.elements.length;i++){e.elements[i].Selector.addClass("lwss_sel_sel")}var c=this.masterObject[f].elements[0].Selectable;var b=(c.data("id")!="")?c.data("id"):"";this.element.find(".lwss_info").hide();this.myStylingPanel.lws_styling_panel("openStylingPanel",f,b);this.myStylingPanel.show()},_clickEditor:function(c){var b=(a(c.target).hasClass("lwss_menu_selector_text")||a(c.target).hasClass("lwss_menu_selector_text"))?a(c.target.parentElement):a(c.target);if(!b.hasClass("lwss_selector")&&!b.hasClass("lwss_menu_selector")){this.element.find(".lwss_selector").removeClass("lwss_sel_sel");this.element.find(".lwss_menu_selector").removeClass("lwss_sel_msel");this.myStylingPanel.lws_styling_panel("setEvent","idle");this.element.find(".lwss_styling_panel").hide();this.element.find(".lwss_info").show()}},_updateMaster:function(){var b=this;a.each(this.cssObject,function(d,c){a.each(c,function(e,f){if(b.masterObject[d]!=undefined){b.masterObject[d].cssValues[e]=f}})})},_resetCss:function(){this.cssObject={};this._createCssObject(this.defaultValues);this._updateMaster();this._applyCssObject();this.makeCssChain();if(this.cssEditor!=undefined){this.cssEditor.codemirror.setValue(this.cssChain)}},_editorCssChanged:function(){var d=this.cssConteneur.find(".CodeMirror-lint-marker-error").length;if(d==0&&this.cssEditor!=undefined){this._cleanStyleObjects();var l=this.cssEditor.codemirror.getValue();var g=l.replace(/(?:\r\n|\r|\n|\t)/g,"");g=g.split("}");for(var f=0;f<g.length;f++){if(g[f]!=""){var n=g[f].split("{");var m=n[0].split(":");var c=m[0].trim();var k=(m[1]==undefined)?"idle":m[1].trim();var b=n[1].split(";");var h={};for(var e=0;e<b.length;e++){if(b[e].indexOf(":")!=-1){h[b[e].split(":")[0].trim()]=b[e].split(":")[1].trim()}}this.cssObject[c]={};this.cssObject[c][k]=h}}this._updateMaster();this._applyCssObject();this.makeCssChain()}},_applyCssObject:function(){a.each(this.cssObject,function(c,b){a.each(b,function(d,e){lwssCanvas.find(c).css(e)})})},_cleanStyleObjects:function(){a.each(this.masterObject,function(c,b){b.cssValues={}});this.cssObject={}},_createCssObject:function(c){var b=this;lwssCanvas=this.element;a.each(c,function(e,g){var d=(g.Selector.split(":"))[0];var h=((g.Selector.split(",")[0].split(":"))[1]!=undefined)?(g.Selector.split(",")[0].split(":"))[1]:"idle";var f=(b.cssObject[d]!=undefined)?b.cssObject[d]:{};f[h]=g.Defaults;if(g.Values!=null&&g.Values!=undefined&&!Array.isArray(g.Values)){f[h]=g.Values}b.cssObject[d]=f;lwssCanvas.find(g.Selector).css(g.Defaults);lwssCanvas.find(g.Selector).css(g.Values)})},makeCssChain:function(){lwssCanvas=this.element;this.cssChain="";var c=this;var b=this.element.find(".lwss_editor_chain");a.each(this.cssObject,function(e,d){a.each(d,function(f,g){if(g!=""){if(f=="idle"){c.cssChain+=e+"{"}else{if(f=="hover"){c.cssChain+=e+":hover, "+e+".hovered{"}else{if(f=="focus"){c.cssChain+=e+":focus, "+e+".focused{"}}}a.each(g,function(j,h){if(h!=undefined&&h!=""){c.cssChain+=j+":"+h+";"}});c.cssChain+="}\n"}})});b.val(lwsBase64.encode(this.cssChain))}})})(jQuery);jQuery(function(a){a(".lwss_editor").lws_css_editor();a(".lwss_editor").click(function(b){if(a(b.target).closest(".lwss-color-selector-relative").length==0&&a(b.target).closest(".lwss-fontselect-popup").length==0){a(".lwss-popup-shadow").hide()}})});