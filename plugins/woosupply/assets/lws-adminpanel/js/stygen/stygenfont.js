(function(b){var d=null;var c=null;var e=null;var a=null;b.widget("lws.lwss_fontselect",{options:{icon:"",cssColor:"",properties:["font-family","font-weight"],values:[],api:"https://fonts.googleapis.com/css?family="},_create:function(){this.wrapper=this.element.addClass("lwss-fontselect-wrapper");this.shadow=b("<div>").addClass("lwss-fontselect-shadow").appendTo(this.wrapper);this.left=b("<div>").addClass("lwss-fontselect-left").appendTo(this.wrapper);this.right=b("<div>").addClass("lwss-fontselect-right").appendTo(this.wrapper);this.icon=b("<div>").addClass("lwss-fontselect-icon "+this.options.icon+" "+this.options.cssColor).appendTo(this.left);this.label=b("<div>").addClass("lwss-fontselect-label").html("Font").appendTo(this.right);this.group=b("<div>").addClass("lwss-fontselect-group").appendTo(this.right);this.input=b("<div>").addClass("lwss-fontselect-input").html("Choose a font...").appendTo(this.group);this.inputbtn=b("<div>").addClass("lwss-fontselect-btn lws-icon-select_arrow_down "+this.options.cssColor).appendTo(this.group);this.family=b("<input>").addClass("lwss-fontselect-family lwss_value").data("css",this.options.properties[0]).attr("type","hidden").prependTo(this.wrapper);this.weight=b("<input>").addClass("lwss-fontselect-weight lwss_value").data("css",this.options.properties[1]).attr("type","hidden").prependTo(this.wrapper);this.mainColor=this.inputbtn.css("color");this.activeFont=null;this.rgba=this.mainColor.replace(")",", 0.1)").replace("rgb","rgba");var f=this;this._buildFontLists();this._buildPopUp();this._manageEvents();this._setTab("Fav")},_bind:function(f,g){return function(){return f.apply(g,arguments)}},_chooseFont:function(g){var f=a[b(g.delegateTarget).css("font-family")];this.family.val(f.Name).trigger("change");this.weight.val("normal").trigger("change")},_setFavourite:function(f){if(d==undefined){d=[]}var g=d.indexOf(f.Name);if(g!=-1){d.splice(g,1)}d.unshift(f.Name);if(d.length>=7){d.pop()}localStorage.setItem("lws-favouriteFonts",lwsBase64.fromObj(d))},_setFont:function(g){var f=a[g.delegateTarget.value];if(f!=undefined){this.input.html(f.Name).css("font-family",f.Name);this._setFavourite(f);this.element.closest(".lwss_editor").find(".lwss-popup-shadow").hide();this.popup.hide()}else{this.input.html("Choose a font...").css("font-family","Gravity").css("font-weight","300")}},_setWeight:function(f){var g=b(f.delegateTarget).val();this.input.html(myFont.Name).css("font-weight",g)},_weightTr:function(f){if(lws_adminpanel.fontWeightTr[f.toLowerCase()]!=undefined){return lws_adminpanel.fontWeightTr[f.toLowerCase()]}return f},_selectVariant:function(g){var f=b(g.delegateTarget);this.family.val(f.data("family")).trigger("change");this.weight.val(f.data("weight")).trigger("change")},_showVariants:function(k){b(".lwss-fontselect-variants").remove();var i=this;var m=b(k.delegateTarget);var l=b("<div>",{"class":"lwss-fontselect-variants",style:"display:none;"}).appendTo(m);l.offset({left:(m.offset().left+m.outerWidth()+1),top:m.offset().top});var f=m.data("variants").split(",");for(var g=0;g<f.length;++g){this._addFontLink(m.data("family"),f[g]);var h=b("<div>").addClass("lwss-fontselect-variantline").appendTo(l);h.html(this._weightTr(f[g])).css("font-family",m.data("family")).css("font-weight",f[g]);h.data("family",m.data("family")).data("weight",f[g]);h.mouseover(function(){b(this).addClass(i.options.cssColor)}).mouseout(function(){b(this).removeClass(i.options.cssColor)});h.click(this._bind(this._selectVariant,this))}l.fadeIn()},_setTab:function(g){this.activeTab=g;var f=this;this.element.find(".lwss_fontselect_tsel").each(function(){if(b(this).data("Tab")==f.activeTab){b(this).css("background-color",f.mainColor).css("color","#ffffff")}else{b(this).css("background-color","transparent").css("color","#444444")}});this.element.find(".lwss-fontselect-tab").each(function(){if(b(this).data("Tab")==f.activeTab){b(this).show()}else{b(this).hide()}})},_openPopup:function(){var f=this;this.gglTab.empty();this.stdTab.empty();this.favTab.empty();b.each(a,function(h,i){var j=i.Display;f._setFontEvents(j,f);if(d.indexOf(i.Name)!=-1){j.appendTo(f.favTab)}else{if(i.Type=="Standard Font"){j.appendTo(f.stdTab)}else{j.appendTo(f.gglTab)}}});if(d!=undefined){this._setTab("Fav")}else{this._setTab("Ggl")}var g=this.element.closest(".lwss_editor").find(".lwss-popup-shadow").show();this.popup.show();return false},_showShadow:function(){this.shadow.show()},_hideShadow:function(){this.shadow.hide()},_manageEvents:function(){var f=this;this.element.mouseenter(this._bind(this._showShadow,this));this.element.mouseleave(this._bind(this._hideShadow,this));this.element.focusin(function(){f.shadow.addClass("lwss-active")});this.element.focusout(function(){f.shadow.removeClass("lwss-active")});this.family.change(this._bind(this._setFont,this));this.weight.change(this._bind(this._setWeight,this));this.group.click(this._bind(this._openPopup,this))},_buildPopUp:function(){this.popup=b("<div>").addClass("lwss-fontselect-popup").appendTo(this.right).hide();this.tabSelectors=b("<div>").addClass("lwss-fontselect-tab-selectors").appendTo(this.popup);this.tabs=b("<div>").addClass("lwss-fontselect-tabs").appendTo(this.popup);this._addFavTab();this._addStandardTab();this._addGoogleTab()},_addFavTab:function(){this.favSelector=b("<div>").addClass("lwss-fontselect-fav-selector lwss_fontselect_tsel").data("Tab","Fav").html("My Favourites").appendTo(this.tabSelectors);var f=this;this.favSelector.click(function(){f._setTab(b(this).data("Tab"))});this.favTab=b("<div>").addClass("lwss-fontselect-tab").data("Tab","Fav").appendTo(this.tabs).hide()},_addStandardTab:function(){this.stdSelector=b("<div>").addClass("lwss-fontselect-std-selector lwss_fontselect_tsel").data("Tab","Std").html("Standard Fonts").appendTo(this.tabSelectors);var f=this;this.stdSelector.click(function(){f._setTab(b(this).data("Tab"))});this.stdTab=b("<div>").addClass("lwss-fontselect-tab").data("Tab","Std").appendTo(this.tabs).hide()},_addGoogleTab:function(){this.gglSelector=b("<div>").addClass("lwss-fontselect-ggl-selector lwss_fontselect_tsel").data("Tab","Ggl").html("Google Fonts").appendTo(this.tabSelectors);var f=this;this.gglSelector.click(function(){f._setTab(b(this).data("Tab"))});this.gglTab=b("<div>").addClass("lwss-fontselect-tab").data("Tab","Ggl").appendTo(this.tabs)},_addFontLink:function(f,h){var g=this.options.api+f;if(h!=undefined&&h.length>0){g+=(":"+h)}if(b("link[href='"+g+"']").length===0){b("link:last").after('<link href="'+g+'" rel="stylesheet" type="text/css">')}},_setFontEvents:function(h,g){var i=h.find(".lwss-fontselect-font-title");i.off().click(g._bind(g._chooseFont,g));i.mouseover(function(){b(this).addClass(g.options.cssColor)}).mouseout(function(){b(this).removeClass(g.options.cssColor)});var f=h.find(".lwss-fontselect-variant-btn");f.off().click(g._bind(g._showVariants,g))},_createFontDisplay:function(f,j){var k=b("<div>").addClass("lwss-fontselect-font-container");var l=b("<div>").addClass("lwss-fontselect-font-title").html(f.Name).css("font-family",f.Name).appendTo(k);var i=b("<div>").addClass("lwss-fontselect-font-cat").html(f.Cat).appendTo(k);var h=b("<div>").addClass("lwss-fontselect-font-type").html(f.Type).appendTo(k);if(f.Variants.length>1){var g=b("<div>",{"class":"lwss-fontselect-variant-btn "+((j.options.cssColor!=undefined)?" "+j.options.cssColor:""),html:f.Variants.length+" variants","data-family":f.Name,"data-variants":f.Variants.join(",")}).appendTo(k)}return k},_addStandardFonts:function(){var k=this;for(var h=0;h<c.length;h++){var f={};f.Variants=[];f.Name=c[h].family;f.Cat=c[h].category;f.Type="Standard Font";for(var g=0;g<c[h].variants.length;g++){if(c[h].variants[g].indexOf("italic")<0){f.Variants.push(c[h].variants[g])}}f.Display=k._createFontDisplay(f,k);a[f.Name]=f}},_addGoogleFonts:function(){var k=this;for(var h=0;h<e.length;h++){if(e[h].family.substring(0,5)!="Slabo"){var f={};f.Variants=[];f.Name=e[h].family;f.Cat=e[h].category;f.Type="Google Font";for(var g=0;g<e[h].variants.length;g++){if(e[h].variants[g].indexOf("italic")<0){f.Variants.push(e[h].variants[g])}}k._addFontLink(f.Name,"normal");f.Display=k._createFontDisplay(f,k);a[f.Name]=f}}},_buildFontLists:function(){var f=this;if(a==null){a={};b.getJSON(lws_ajax_url,{action:"lws_adminpanel_googlefontlist"},function(g){if(null==g){console.log("Font ressource error.")}else{if(0==g){console.log("Ajax action not found.")}else{e=g.items;f._addGoogleFonts()}}}).fail(function(h,i,g){console.log("Ajax failed with status "+i+", error: "+g)});b.getJSON(lws_ajax_url,{action:"lws_adminpanel_standardfontlist"},function(g){if(null==g){console.log("Font ressource error.")}else{if(0==g){console.log("Ajax action not found.")}else{c=g.items;f._addStandardFonts()}}}).fail(function(h,i,g){console.log("Ajax failed with status "+i+", error: "+g)});d=[];if(localStorage.getItem("lws-favouriteFonts")){d=lwsBase64.toObj(localStorage.getItem("lws-favouriteFonts"))}}}})})(jQuery);jQuery(function(a){a(document).click(function(b){if(a(b.target).closest(".lwss-fontselect-popup").length==0){a(".lwss-fontselect-popup").hide()}});a(document).keyup(function(b){if((b.keyCode||b.which||b.charCode||0)===27){a(".lwss-fontselect-popup").hide()}})});