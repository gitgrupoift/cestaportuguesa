(function(b){b.fn.closeColorSelector=function(){return this.each(function(){if(this._lwsColorSelector!=undefined){this._lwsColorSelector.trigEdited()}}).remove()};function a(){this.updated=null;this.edited=null;this.newColor="#000000";this.oldColor="#000000";this._main=null;this.trigEdited=function(){if(this.edited!=null){this.edited(this.newColor)}};this._html=function(){str="<div id='lwss-color-selector-container' class='lwss-color-selector-relative'>";str+="<div class='lwss-color-selector-dialog'>";str+="<div class='lwss-color-column lwss-color-sliders'>";str+="<div class='lwss-color-line'>";str+="<div class='lwss-color-slide-container lwss-color-slide-xy'>";str+="<div class='lwss-color-slide lwss-color-bg-s'></div>";str+="<div class='lwss-color-slide lwss-color-bg-b'></div>";str+="<div class='lwss-color-cursor lwss-color-cursor-sb'></div>";str+="<div class='lwss-color-slide lwss-color-interact'></div>";str+="</div>";str+="<div class='lwss-color-slide-container lwss-color-slide-y'>";str+="<div class='lwss-color-slide lwss-color-bg-h'></div>";str+="<div class='lwss-color-cursor lwss-color-cursor-h'></div>";str+="<div class='lwss-color-slide lwss-color-interact'></div>";str+="</div></div>";str+="<div class='lwss-color-line'>";str+="<div class='lwss-color-slide-container lwss-color-slide-x'>";str+="<div class='lwss-color-slide lwss-color-damier'></div>";str+="<div class='lwss-color-slide lwss-color-bg-a'></div>";str+="<div class='lwss-color-cursor lwss-color-cursor-a'></div>";str+="<div class='lwss-color-slide lwss-color-interact'></div>";str+="</div>";str+="<div class='lwss-color-slide-container'>";str+="<div class='lwss-color-demo-small lwss-color-damier'></div>";str+="<div class='lwss-color-demo-small lwss-color-demo-next'></div>";str+="</div>";str+="</div>";str+="</div>";str+="<div class='lwss-color-column lwss-color-details' >";str+="<div class='lwss-color-composition'>";str+="<div class='lwss-color-parts lwss-color-hsl'>";str+="<label><div>H</div><input type='text' pattern='(3[0-6]\\d)|([0-2]?\\d?\\d)' data-ref='hsl' data-index='0' size='2'></label>";str+="<label><div>S</div><input type='text' pattern='([01]?\\d?\\d)' data-ref='hsl' data-index='1' size='2'></label>";str+="<label><div>B</div><input type='text' pattern='([01]?\\d?\\d)' data-ref='hsl' data-index='2' size='2'></label>";str+="<label><div>A</div><input type='text' pattern='([01]?\\d?\\d)' data-ref='hsl' data-index='3' size='2'></label>";str+="</div>";str+="<div class='lwss-color-parts lwss-color-rgb'>";str+="<label><div>R</div><input type='text' pattern='(25[0-5])|(2[0-4]\\d)|([01]?\\d?\\d)' data-ref='rgb' data-index='0' size='2'></label>";str+="<label><div>G</div><input type='text' pattern='(25[0-5])|(2[0-4]\\d)|([01]?\\d?\\d)' data-ref='rgb' data-index='1' size='2'></label>";str+="<label><div>B</div><input type='text' pattern='(25[0-5])|(2[0-4]\\d)|([01]?\\d?\\d)' data-ref='rgb' data-index='2' size='2'></label>";str+="<label><div>A</div><input type='text' pattern='(25[0-5])|(2[0-4]\\d)|([01]?\\d?\\d)' data-ref='rgb' data-index='3' size='2'></label>";str+="</div></div>";str+="<div class='lwss-new-color'><input type='text' class='lwss-color-input-next' pattern='((rgba?|hsla?)\\(\\d+(\\.\\d+)?%?(,\\d+(\\.\\d+)?%?)*\\))|(#[0-9a-fA-F]{3,8})' size='8'>";str+="<div tabindex=0 class='lwss-new-color-submit'></div>";str+="</div></div></div></div></div></div>";return str};this.clampRGBA=function(c){for(var d=0;d<c.length;++d){c[d]=Math.max(0,Math.min(255,c[d]))}return c};this.clampHSLA=function(c){c[0]=Math.max(0,Math.min(360,c[0]));for(var d=1;d<c.length;++d){c[d]=Math.max(0,Math.min(100,c[d]))}return c};this.toRGBA=function(w){var k=6*w[0]/360,y=w[1]/100,u=w[2]/100;var j=Math.floor(k),m=k-j,e=u*(1-y),d=u*(1-m*y),x=u*(1-(1-m)*y),o=j%6,c=[u,d,e,e,x,u][o],l=[x,u,u,d,e,e][o],n=[e,e,x,u,u,d][o];return this.clampRGBA([c*255,l*255,n*255,255*w[3]/100])};this.toHSLA=function(k){var c=k[0]/255,i=k[1]/255,l=k[2]/255;var m=Math.max(c,i,l),e=Math.min(c,i,l);var f,o,n=m;var j=m-e;o=m===0?0:j/m;if(m==e){f=0}else{switch(m){case c:f=(i-l)/j+(i<l?6:0);break;case i:f=(l-c)/j+2;break;case l:f=(c-i)/j+4;break}f/=6}return this.clampHSLA([f*360,o*100,n*100,100*k[3]/255])};this.fromColorCursor=function(e,c){var d=e.parent();if(c){return(e.offset().left-d.offset().left)/(d.innerWidth()-e.outerWidth())}else{return(e.offset().top-d.offset().top)/(d.innerHeight()-e.outerHeight())}};this.toColorCursor=function(f,c,d){var e=f.parent();if(c){f.offset({left:((e.innerWidth()-f.outerWidth())*d)+e.offset().left})}else{f.offset({top:((e.innerHeight()-f.outerHeight())*d)+e.offset().top})}};this.moveColorCursor=function(d){var f=b(d.target).parent().find(".lwss-color-cursor");var c=d.pageX-d.target.offsetLeft-(f.outerWidth()/2);var g=d.pageY-d.target.offsetTop-(f.outerHeight()/2);if(f.parent().hasClass("lwss-color-slide-xy")){f.offset({top:g,left:c})}else{if(f.parent().hasClass("lwss-color-slide-x")){f.offset({left:c})}else{if(f.parent().hasClass("lwss-color-slide-y")){f.offset({top:g})}}}};this.colorSelect=function(j){if(j.buttons==1){this.moveColorCursor(j);var i=b(j.target).closest(".lwss-color-sliders");var g=i.find(".lwss-color-cursor-h");var c=i.find(".lwss-color-cursor-sb");var d=i.find(".lwss-color-cursor-a");var f=[360*this.fromColorCursor(g,g.parent().hasClass("lwss-color-slide-x")),100*this.fromColorCursor(c,true),100-(100*this.fromColorCursor(c,false)),100*this.fromColorCursor(d,d.parent().hasClass("lwss-color-slide-x"))];this.applyColor(undefined,this.clampHSLA(f))}};this.litteralColor=function(c,f){var e="";if((Math.abs(c[3]-255)<0.00001)||(f===true)){e="#";for(var d=0;d<3;++d){e+=(c[d]<16?"0":"")+Math.round(c[d]).toString(16)}}else{e="rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+(c[3]/255).toFixed(3)+")"}return e};this.applyGradient=function(g,c,m,o,h,e,l,n,f,d){var j=this.litteralColor(this.toRGBA([m,o,h,e]),false);var i=this.litteralColor(this.toRGBA([l,n,f,d]),false);var k="background: -webkit-linear-gradient("+(c?"left,":"top,")+j+","+i+");";k+="background: -o-linear-gradient("+(c?"left,":"top,")+j+","+i+");";k+="background: -moz-linear-gradient("+(c?"left,":"top,")+j+","+i+");";k+="background: linear-gradient("+(c?"to right,":"to bottom,")+j+","+i+");";g.attr("style",k)};this.applyColor=function(f,e){if(f===undefined){f=this.toRGBA(e)}else{if(e===undefined){e=this.toHSLA(f)}}this.newColor=this.litteralColor(f,false);this._main.find("input.lwss-color-input-next").val(this.newColor);this._main.find(".lwss-color-demo-next").css("background",this.newColor);this._main.find(".lwss-color-parts input").each(function(){b(this).val(Math.round((b(this).data("ref")=="rgb"?f:e)[b(this).data("index")]))});var i=this._main.find(".lwss-color-sliders");var g=i.find(".lwss-color-cursor-h");g.css("background-color",this.litteralColor(this.toRGBA([e[0],100,100,100]),true));var c=i.find(".lwss-color-cursor-sb");var d=i.find(".lwss-color-cursor-a");this.toColorCursor(g,g.parent().hasClass("lwss-color-slide-x"),e[0]/360);this.toColorCursor(c,true,e[1]/100);this.toColorCursor(c,false,1-(e[2]/100));this.toColorCursor(d,d.parent().hasClass("lwss-color-slide-x"),e[3]/100);var d=i.find(".lwss-color-bg-a");this.applyGradient(d,d.parent().hasClass("lwss-color-slide-x"),e[0],e[1],e[2],0,e[0],e[1],e[2],100);this.applyGradient(i.find(".lwss-color-bg-s"),true,e[0],0,100,100,e[0],100,100,100);if(this.updated!=null){this.updated(this.newColor)}};this.reset=function(){this.setColor(this.oldColor)};this.composeColor=function(c){var d=[0,0,0,0];c.find("input").each(function(){d[b(this).data("index")]=parseInt(b(this).val())});return d};this.composeFromRGB=function(d){var c=this.composeColor(b(d.target).closest(".lwss-color-parts"));this.applyColor(this.clampRGBA(c),undefined);return false};this.composeFromHSL=function(d){var c=this.composeColor(b(d.target).closest(".lwss-color-parts"));this.applyColor(undefined,this.clampHSLA(c));return false};this.demoShowNew=function(c){b(c.target).css("background",this.newColor)};this.demoShowOld=function(c){b(c.target).css("background",this.oldColor)};this.changeColor=function(c){this.setColor(b(c.target).val(),false)};this.textRgb=function(e){var c=e.match(/\d+(\.\d+)?%?/g);for(var d=0;d<c.length;++d){c[d]=(c[d].endsWith("%")?(255*c[d].split("%")[0]/100):c[d])}if(c.length<4){c.push(1)}c[3]=c[3]*255;return c};this.setColor=function(j,c){try{j=j.trim();var f=[0,0,0,255],d=[0,0,0,100];if(j.length>0){if(j.startsWith("#")){if(j.length>5){f=j.match(/[0-9A-Fa-f]{2}/g)}else{f=j.match(/[0-9A-Fa-f]/g);for(var g=0;g<f.length;++g){f[g]=f[g].concat(f[g])}}for(var g=0;g<f.length;++g){f[g]=parseInt(f[g],16)}if(f.length<4){f.push(255)}d=this.toHSLA(f)}else{if(j.startsWith("hsl")){d=j.match(/\d+(\.\d+)?/g);if(d.length<4){d.push(1)}d[3]=d[3]*100;f=this.toRGBA(d)}else{if(j.startsWith("rgb")){f=this.textRgb(j);d=this.toHSLA(f)}else{try{var k=b("<div />").css("background-color",j);j=window.getComputedStyle(k[0]).backgroundColor}catch(h){}f=this.textRgb(j);d=this.toHSLA(f)}}}}f=this.clampRGBA(f);if(c!=false){this.oldColor=this.litteralColor(f,false)}this.applyColor(f,this.clampHSLA(d))}catch(h){console.log("Invalid value.")}return false};this.show=function(d){if(this.offset!=undefined){this._main=b(this._html()).appendTo(b("body"));this._main.offset({top:(this.offset.top+14),left:this.offset.left})}else{this._main=b(this._html()).appendTo(d)}this._main[0]._lwsColorSelector=this;var e=this;var c=this._main.find("input.lwss-color-input-next");c.change(function(f){e.changeColor(f)});c.keydown(function(f){if((f.keyCode||f.which||f.charCode||0)===9){e._main.find(".lwss-color-composition input:"+(f.shiftKey?"last":"first")).focus();return false}});this._main.find(".lwss-new-color-submit").click(function(){b("#lwss-color-selector-container").closeColorSelector()});this._main.find("input").focus(function(){b(this).select()});this._main.find(".lwss-color-interact").mousedown(function(f){e.colorSelect(f)});this._main.find(".lwss-color-interact").mousemove(function(f){e.colorSelect(f)});this._main.find(".lwss-color-hsl input").change(function(f){e.composeFromHSL(f)});this._main.find(".lwss-color-rgb input").change(function(f){e.composeFromRGB(f)});this._main.find(".lwss-color-demo-small.lwss-color-demo-next").mouseenter(function(f){e.demoShowOld(f)});this._main.find(".lwss-color-demo-small.lwss-color-demo-next").mouseleave(function(f){e.demoShowNew(f)});this._main.find(".lwss-color-demo-small.lwss-color-demo-next").click(function(f){e.reset(f)});this.reset();c.focus()}}b.fn.colorSelector=function(d){if(this.length>0){b("#lwss-color-selector-container").remove();var c=new a();if(d!=undefined){if(d.color!=undefined){c.oldColor=d.color}if(d.updated!=undefined){c.updated=d.updated}if(d.edited!=undefined){c.edited=d.edited}if(d.offset!=undefined){c.offset=d.offset}}c.show(this);return c}return this};b.widget("lws.lwss_colorButton",{options:{color:"",showvalue:true,icon:"lws-icon-lw_dropper",cssColor:"lwss-colorpicker-default-color",property:""},_create:function(){this.wrapper=this.element.addClass("lwss-colorpicker-wrapper");this.shadow=b("<div>").addClass("lwss-colorpicker-shadow").appendTo(this.wrapper);this.left=b("<div>").addClass("lwss-colorpicker-left").appendTo(this.wrapper);this.right=b("<div>").addClass("lwss-colorpicker-right").appendTo(this.wrapper);this.icon=b("<div>").addClass("lwss-colorpicker-icon "+this.options.icon+" "+this.options.cssColor).appendTo(this.left);this.demo=b("<div>").addClass("lwss-colorpicker-demo").appendTo(this.left);this.value=b("<input>").addClass("lwss-colorpicker-value lwss_value").data("css",this.options.property).appendTo(this.right);this.label=b("<div>").addClass("lwss-colorpicker-label").html(this.options.property).appendTo(this.right);this.wrapper.mouseenter(this._bind(this._showShadow,this));this.wrapper.mouseleave(this._bind(this._hideShadow,this));if(this.value.val().length>0){this.options.color=this.value.val()}this._applyColor(this.options.color);var c=this;this.left.click(this._bind(this.open,this));this.value.change(this._bind(this._changeVal,this));this.value.focus(function(){this.select()})},_bind:function(c,d){return function(){return c.apply(d,arguments)}},_showShadow:function(){this.shadow.show()},_hideShadow:function(){this.shadow.hide()},_applyColor:function(c){this.demo.css("background-color",c);this.value.val(c)},_changeVal:function(){this.options.color=this.value.val();this.demo.css("background-color",this.options.color)},open:function(){var c=this;var e=b(this.element).closest(".lwss_editor").find(".lwss-popup-shadow").show();var d={color:c.options.color,edited:function(f){c.color.call(c,f)},offset:this.element.offset()};c.element.colorSelector(d);return false},color:function(d){if(d===undefined){return this.options.color}var c=this.options.color;this.options.color=d;this._applyColor(this.options.color);if(c!=this.options.color){this._trigger("changed",null,this.options.color);this.value.trigger("change")}},_destroy:function(){this.wrapper.remove()}});b.widget("lws.lws_color_picker",{options:{color:"#FFFFFF",title:""},_create:function(){this._setOptions();this._createStructure();this.demo=this.element.find(".lws-cp-demo");this.input=this.element.find(".lws-cp-input");this._applyColor(this.options.color);this.demo.click(this._bind(this.open,this));this.input.change(this._bind(this._changeVal,this));this.input.focus(function(){this.select()})},_bind:function(c,d){return function(){return c.apply(d,arguments)}},_setOptions:function(){if(this.element.data("title")!=undefined){this.options.title=this.element.data("title")}if(this.element.data("color")!=undefined){this.options.color=this.element.data("color")}},_createStructure:function(){b("<div>",{"class":"lws-cp-left"}).append(b("<div>",{"class":"lws-cp-demo"})).appendTo(this.element);b("<div>",{"class":"lws-cp-right"}).append(b("<input>",{"class":"lws-cp-input"})).append(b("<div>",{"class":"lws-cp-title",html:this.options.title})).appendTo(this.element)},_applyColor:function(c){this.demo.css("background-color",c);this.input.val(c)},_changeVal:function(){this.options.color=this.input.val();this.demo.css("background-color",this.options.color)},open:function(){var c=this;var d={color:c.options.color,edited:function(e){c.color.call(c,e)},offset:this.element.offset()};c.element.colorSelector(d);return false},color:function(d){if(d===undefined){return this.options.color}var c=this.options.color;this.options.color=d;this._applyColor(this.options.color);if(c!=this.options.color){this._trigger("changed",null,this.options.color);this.input.trigger("change")}},_destroy:function(){this.element.remove()}});b.fn.colorBtn=function(){return this.each(function(){var f=b(this);var e=f.find(".lwss-btn-color-demo");var d=f.find(".lwss-btn-color-value");var c=f.find("input");f.click(function(){var g={color:d.html(),edited:function(h){e.css("backgroundColor",h);d.html(h);if(c.hasClass("lwss-merge-css")){e.mergeCSS()}else{c.val(h)}}};f.parent().colorSelector(g);return false})})}})(jQuery);jQuery(function(a){a(document).click(function(b){if(a(b.target).closest(".lwss-color-selector-relative").length==0){a("#lwss-color-selector-container").remove()}});a(document).keyup(function(b){if((b.keyCode||b.which||b.charCode||0)===27){a("#lwss-color-selector-container").remove()}else{if((a(b.target).closest(".lwss-color-selector-relative").length>0)&&((b.keyCode||b.which||b.charCode||0)===13)){a("#lwss-color-selector-container").closeColorSelector()}}});a(".lwss-btn-color-selector").colorBtn();a(".lws-color-button").lwss_colorButton();a(".lws-color-picker").lws_color_picker()});