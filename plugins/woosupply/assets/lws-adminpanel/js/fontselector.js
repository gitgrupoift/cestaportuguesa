(function(a){a.fn.fontselector=function(j){var i=null;var c=null;var h=null;var b=null;var d={ajax:lws_ajax_url,action:"lws_adminpanel_fontlist",api:"https://fonts.googleapis.com/css?family=",interval:500};var e=(j!=undefined)?j:"";var f=function(k,l){return function(){return k.apply(l,arguments)}};var g=(function(){function k(m,n,l){this.$original=a(m);this.options=n;this.cssOptions=l;this.setupHtml();this.loadFonts(this);this.bindEvents()}k.prototype.setupHtml=function(){this.$family=this.$original.find(".lwss-fontselect-family").hide();this.$weight=this.$original.find(".lwss-fontselect-weight").hide();this.main=this.$original.find(".lwss-fontname-select");this.main.attr("tabindex","0");this.$select=a("<div>",{"class":"lwss-fontname-select-text"}).html(this.fontDescription());this.addFontLink(this.$family.val(),this.$weight.val());this.setFontStyle(this.$select,this.$family.val(),this.$weight.val());this.$arrow=a("<div>",{"class":"lwss-fontname-select-btn lws-icon-select_arrow_down"+((this.cssOptions.cssColor!=undefined)?" "+this.cssOptions.cssColor:"")});this.$list=a("<div>",{"class":"lwss-font-list lwss-hide-on-clic-out",style:"display:none;"});var l=a("<div>",{"class":"lwss-font-list-toggle"}).appendTo(this.$list);this.$toggleMore=a("<div>",{"class":"lwss-font-list-toggle-more"}).appendTo(l).html(lws_adminpanel.fontToggleMore);this.$toggleLess=a("<div>",{"class":"lwss-font-list-toggle-less"}).appendTo(l).html(lws_adminpanel.fontToggleLess).hide();this.main.append(this.$select).append(this.$arrow);this.$original.remove(".lwss-font-list").append(this.$list)};k.prototype.fontDescription=function(){return(this.$family.val().length>0?(this.$family.val()+(this.$weight.val().length>0?(" : "+this.weightTr(this.$weight.val())):"")):lws_adminpanel.fontPlaceHolder)};k.prototype.weightTr=function(l){if(lws_adminpanel.fontWeightTr[l.toLowerCase()]!=undefined){return lws_adminpanel.fontWeightTr[l.toLowerCase()]}return l};k.prototype.toggleFontList=function(){if(this.$list.is(":visible")){if(this.$toggleMore.is(":visible")){this.$toggleMore.hide();this.$toggleLess.show();this.loadAllFonts(this)}else{this.$toggleLess.hide();this.$toggleMore.show();this.loadFonts(this)}}};k.prototype.createFontList=function(r,t){var q=a("<div>",{"class":"lwss-font-list-content"});for(var n=0;n<r.length;++n){var o=r[n];var u=a("<div>",{"class":"lwss-font-list-line"});if(t!=undefined&&n<t){i.append(u)}else{q.append(u)}var s=a("<div>",{"class":"lwss-font-list-line-family lwss-font-list-item-to-style"}).html(o.family).attr("data-family",o.family).appendTo(u);var p=[];for(var m=0;m<o.variants.length;++m){if(o.variants[m].indexOf("italic")<0){p.push(o.variants[m])}}if(p.length>1){var l=a("<div>",{"class":"lwss-font-list-line-btn lws-icon-select_arrow_right "+((this.cssOptions.cssColor!=undefined)?" "+this.cssOptions.cssColor:""),"data-family":o.family,"data-variants":p.join(",")}).appendTo(u);l.click(f(this.showVariants,this))}s.click(f(this.selectFamily,this))}return q};k.prototype.setFonts=function(m,l){a(".lwss-font-list-variant").remove();this.$list.find(".lwss-font-list-content").detach();this.$list.find(".lwss-font-list-last-used").detach();if(l==undefined){if(h==null){h=this.createFontList(m,l)}this.$list.prepend(h)}else{if(i==null){i=a("<div>",{"class":"lwss-font-list-last-used"})}if(c==null){c=this.createFontList(m,l)}this.$list.prepend(c);this.$list.prepend(i);if(i.children().length<=0){i.hide()}}this.scrollToSelection()};k.prototype.selectFamily=function(m){if(b!=null){var l=a(m.target).closest("div.lwss-font-list-line-family");this.$list.hide();b.applyFont.call(b,l.data("family"))}};k.prototype.showVariants=function(q){var p=a(q.target).closest("div[data-variants]");a(".lwss-font-list-variant").remove();var o=a("<div>",{"class":"lwss-font-list-variant",style:"display:none;"}).appendTo(p);o.offset({left:(p.offset().left+p.outerWidth()),top:p.offset().top});var l=p.data("variants").split(",");for(var n=0;n<l.length;++n){var m=a("<div>",{"class":"lwss-font-list-line lwss-font-list-item-to-style"}).appendTo(o);a("<span>",{"class":"lwss-font-list-line-variant"}).appendTo(m).html(this.weightTr(l[n]));m.data("family",p.data("family")).data("weight",l[n]);m.click(f(this.selectVariant,this))}o.fadeIn()};k.prototype.selectVariant=function(m){if(b!=null){var l=a(m.target).closest("div.lwss-font-list-line");this.$list.hide();b.applyFont.call(b,l.data("family"),l.data("weight"))}};k.prototype.applyFont=function(l,m){this.$family.val(l);if(m==undefined){m=""}this.$weight.val(m);this.$family.trigger("change");this.$weight.trigger("change")};k.prototype.upUsedFont=function(n){if(i!=null){i.show();var l="div.lwss-font-list-line-family[data-family='"+n+"']";if(h==null){var m=c.find(l).parent().detach();if(m.length<=0){m=i.find(l).parent().detach()}i.prepend(m)}else{c.find(l).parent().remove();i.find(l).parent().remove();i.prepend(h.find(l).parent().clone(true,true))}}};k.prototype.addFontLink=function(l,n){var m=this.options.api+l;if(n!=undefined&&n.length>0){m+=(":"+n)}if(a("link[href='"+m+"']").length===0){a("link:last").after('<link href="'+m+'" rel="stylesheet" type="text/css">')}};k.prototype.setFontStyle=function(o,m,n){var l="font-family:"+m;if(n!=undefined&&n.length>0){l+=(";font-weight:"+n)}o.attr("style",l)};k.prototype.loadFonts=(function(){var n=null;var m=0;var l=[];return function(o){if(n==null){l.push(o);if(l.length==1){a(".lwss-font-list-toggle").addClass("ui-autocomplete-loading");a.getJSON(lws_ajax_url,{action:"lws_adminpanel_fontlist"},function(p){if(null==p){console.log("Font ressource error.")}else{if(0==p){console.log("Ajax action not found.")}else{n=p.items;m=p.lastUsedCount;l.forEach(function(q){q.setFonts.call(q,n,m)});l=[];a(".lwss-font-list-toggle").removeClass("ui-autocomplete-loading")}}}).fail(function(q,r,p){console.log("Ajax failed with status "+r+", error: "+p)})}}else{o.setFonts.call(o,n,m)}return n}})();k.prototype.loadAllFonts=(function(){var m=null;var l=[];return function(n){if(m==null){l.push(n);if(l.length==1){a(".lwss-font-list-toggle").addClass("ui-autocomplete-loading");a.getJSON(lws_ajax_url,{action:"lws_adminpanel_fontlist",all:1},function(o){if(null==o){console.log("Font ressource error.")}else{if(0==o){console.log("Ajax action not found.")}else{m=o.items;l.forEach(function(p){p.setFonts(m)});l=[];a(".lwss-font-list-toggle").removeClass("ui-autocomplete-loading")}}}).fail(function(p,q,o){console.log("Ajax failed with status "+q+", error: "+o)})}}else{n.setFonts(m)}return m}})();k.prototype._externalChange=function(){this.$select.html(this.fontDescription());this.addFontLink(this.$family.val(),this.$weight.val());this.setFontStyle(this.$select,this.$family.val(),this.$weight.val());this.upUsedFont(this.$family.val())};k.prototype.bindEvents=function(){this.$arrow.parent().click(f(this.dropDown,this));this.$toggleMore.click(f(this.toggleFontList,this));this.$toggleLess.click(f(this.toggleFontList,this));this.$family.change(f(this._externalChange,this));this.$weight.change(f(this._externalChange,this))};k.prototype.dropDown=function(){a(".lwss-hide-on-clic-out").fadeOut();a(".lwss-fold-on-clic-out").slideUp();b=this;this.loadFonts(this);this.$list.fadeIn();this.$toggleLess.hide();this.$toggleMore.show();this.$list.offset({left:this.$original.offset().left,top:(this.$original.offset().top+this.$select.outerHeight())});this.scrollToSelection();this.testVisibilityInterval=setInterval(f(this.styleVisibleFonts,this),this.options.interval);return false};k.prototype.scrollToSelection=function(){var l=this.$list.find("[data-family='"+this.$family.val()+"']:first");if(l.length>0){var m=l.closest(".lwss-font-list-line").position().top-this.$list.find(".lwss-font-list-line:first").position().top;this.$list.find(".lwss-font-list-content").scrollTop(m)}};k.prototype.dropUp=function(){this.$list.fadeOut();if(this.testVisibilityInterval!=undefined){clearInterval(this.testVisibilityInterval);this.testVisibilityInterval=undefined}};k.prototype.styleVisibleFonts=function(){if(this.$list.is(":hidden")){if(this.testVisibilityInterval!=undefined){clearInterval(this.testVisibilityInterval);this.testVisibilityInterval=undefined}}else{var o=this.$list.find(".lwss-font-list-content");var n=o.scrollTop();var l=n+o.height();var m=this;this.$list.find(".lwss-font-list-item-to-style").each(function(){if(!this.hasAttribute("style")){var q=a(this).closest(".lwss-font-list-line");var p=q.position().top+n;var s=p+a(this).height();if((s>=n)&&(p<=l)){m.addFontLink(a(this).data("family"),a(this).data("weight"));m.setFontStyle(a(this),a(this).data("family"),a(this).data("weight"))}}})}};return k})();return this.each(function(k){if(k){a.extend(d,k)}return new g(this,d,e)})}})(jQuery);jQuery(function(a){a(".lwss-fontname-group").fontselector()});