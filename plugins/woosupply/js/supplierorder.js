jQuery(function(b){b("#order_remote_invoice_paid").change(function(){if(this.checked){b("#order_remote_invoice_paid_date").show()}else{b("#order_remote_invoice_paid_date").hide()}});b("#order_remote_invoice_paid_date").toggle(b("#order_remote_invoice_paid").prop("checked"));b(lwsBase64.decode(b("#lws_woosupply_supplierorder_items").data("template"))).appendTo(b("#lws_woosupply_supplierorder_items_body")).find(".lac_select").lac_select();b("#lws_woosupply_supplierorder_items_body").on("keyup",".order_items_row:last-child input",function(){if(b(this).val().length>0){b(lwsBase64.decode(b("#lws_woosupply_supplierorder_items").data("template"))).appendTo(b("#lws_woosupply_supplierorder_items_body")).find(".lac_select").lac_select()}});function a(h){var f=(h!=undefined?b(h.currentTarget):b("#lws_woosupply_supplierorder_items_body"));var g={timestamp:(document.lws_woosupply_supplierorder_ajax_timestamp=(document.lws_woosupply_supplierorder_ajax_timestamp==undefined?0:(document.lws_woosupply_supplierorder_ajax_timestamp+1))),quantities:[],uprices:[],keys:[]};b("#lws_woosupply_supplierorder_items_body").find(".order_items_row").each(function(){g.quantities.push(b(this).find("input.quantity").val());g.uprices.push(b(this).find("input.unitPrice").val());g.keys.push(b(this).find("input.lws_woosupply_supplierorder_items_key").val())});if(f.prop("tagName").toLowerCase()=="input"){var i=f.closest(".order_items_row");var d=parseFloat(i.find("input.unitPrice").val().replace(",","."));if(!isNaN(d)&&d<0){i.find("input.unitPrice").val("+")}i.find("input.amount").val(parseFloat(i.find("input.quantity").val().replace(",","."))*d)}var c=0;b("#lws_woosupply_supplierorder_items_body").find("input.amount").each(function(){var e=b(this).val();e=e.replace(lws_woosupply_price_format.thousand_separator,"");e=e.replace(lws_woosupply_price_format.decimal_separator,".");var j=parseFloat(e);if(!isNaN(j)){c+=j}});b('#lws_woosupply_supplierorder_items_foot [data-column="total_value"]').html(c);b.ajax({dataType:"json",url:b("#lws_woosupply_supplier_details").data("service"),method:"POST",data:g,success:function(e){if(e.error!=undefined){alert(e.error)}else{if(e.timestamp!=undefined&&e.timestamp==document.lws_woosupply_supplierorder_ajax_timestamp){var j=0;b("#lws_woosupply_supplierorder_items_body").find(".order_items_row").each(function(){if(e.quantities[j]!=undefined){b(this).find("input.quantity").val(e.quantities[j])}if(e.uprices[j]!=undefined){b(this).find("input.unitPrice").val(e.uprices[j])}if(e.amounts[j]!=undefined){b(this).find("input.amount").val(e.amounts[j])}++j});if(e.total!=undefined){b('#lws_woosupply_supplierorder_items_foot [data-column="total_value"]').html(e.total)}}}}}).fail(function(){console.log("Cannot reach price formating webservice.")})}b("#lws_woosupply_supplierorder_items").on("change",".order_items_row input.quantity,.order_items_row input.unitPrice",a);b("#lws_woosupply_supplierorder_items_body").on("click",".lws-woosupply-supplierorder-item-delete",function(){b(this).closest(".order_items_row").remove();a()});b("#supplier_edit").click(function(){b(this).hide();b("#supplier-info-div").hide();b("#lws_woosupply_supplier_details").show()});b("#delivery_edit").click(function(){b(this).hide();b("#delivery-info-div").hide();b("#lws_woosupply_delivery_details").show()});b(".lws-adminpanel-singular-commit-button").click(function(){b("#lws_adminpanel_singular_form_lws_woosupply_supplierorder").find(".lws-required").each(function(){if(!b(this).lws_required("test")){if(b(this).closest("#lws_woosupply_supplier_details").length>0){b("#supplier_edit").trigger("click")}else{if(b(this).closest("#lws_woosupply_delivery_details").length>0){b("#delivery_edit").trigger("click")}}}})});b("#order_supplier_id").change(function(){var e=b("#order_supplier_id").val().trim();if(e!=false){var d=b("#lws_woosupply_supplier_details");var f=b("#supplier-info-div");var c=[];b.getJSON(d.data("service"),{action:"lws_woosupply_supplier_get",supplier_id:e},function(g){if(g.error==undefined){b.each(g,function(h,i){if(h=="contact_firstname"){c[0]=i}if(h=="contact_lastname"){c[1]=i}f.find('[data-name="order_supplier_'+h+'"]').html(i);d.find('input[name="order_supplier_'+h+'"]').val(i).trigger("change")});f.find('[data-name="order_supplier_contact"]').html(c[0]+" "+c[1]);d.find('input[name="order_supplier_contact"]').val(c[0]+" "+c[1]).trigger("change")}else{alert(g.error)}}).fail(function(){alert("Cannot reach supplier info webservice.")})}else{b("#lws_woosupply_supplier_details input").val("").trigger("change")}});b("#order_remote_invoice_attachement").on("change",function(){var c=b("#upload_max_size");if(c.length>0&&b("#order_remote_invoice_attachement").prop("files")[0].size>c.val()){alert(c.data("warn"));b(".lws-file-selected").text(c.data("warn")).show()}else{b(".lws-file-selected").text(b("#order_remote_invoice_attachement").prop("files")[0].name).show()}});b(".lws-file-selected").hide();b("#order_remote_invoice_amount").change(function(){var d=b(this);var c=d.val().trim();if(c.length>0){b.ajax({url:lws_ajax_url,dataType:"text",data:{action:"lws_woosupply_format_price",price:c},success:function(e){d.val(e)}}).fail(function(){console.log("Cannot reach price formating webservice.");c=parseFloat(c.replace(",","."));d.val(isNaN(c)?"":c)})}else{d.val("")}})});